# Acceberg 商品分析BI平台

## 项目简介

Acceberg是一个基于Flask + Dash + SQLite技术栈开发的商品分析BI平台，主要用于分析1688平台上的商品数据，包括羽绒服、烧烤食材和年货三大品类。平台提供数据可视化、多维度分析、用户认证等功能，帮助用户快速了解商品销售情况。

## 技术栈

- **后端框架**：Flask（提供Web服务和API）
- **前端可视化**：Dash（基于Plotly的BI仪表盘）
- **数据库**：SQLite3 + SQLAlchemy ORM
- **用户认证**：Flask-JWT-Extended（JWT令牌） + Flask-Bcrypt（密码加密）
- **数据清洗**：Pandas + 正则表达式
- **前端样式**：Bootstrap（通过Dash Bootstrap Components）

## 核心功能

### 1. 数据可视化
- **仪表盘概览**：显示销售额、订单量、访客数等关键指标
- **趋势分析**：7天销售额和订单量趋势图
- **地理分布**：省级销售额热力地图
- **品类分析**：各品类商品数占比和销售额对比
- **公司排行**：销售额TOP10公司

### 2. 商品分析
- **商品列表**：支持品类筛选、价格区间筛选、排序功能
- **价格分布**：商品价格直方图
- **销量与销售额关系**：散点图分析
- **数据导出**：支持导出商品数据

### 3. 用户管理
- **用户注册**：支持新用户注册
- **用户登录**：基于JWT的身份认证
- **权限控制**：保护敏感接口

### 4. 数据处理
- **CSV数据导入**：支持批量导入商品数据
- **数据清洗**：自动清洗成交金额和销量数据
- **数据去重**：基于商品链接去重

## 项目结构

```
project/
├── logs/                 # 日志目录
│   └── app.log           # 应用日志文件
├── templates/            # 前端模板目录
│   ├── login.html        # 登录页面
│   └── register.html     # 注册页面
├── utils_file/           # 工具目录
│   ├── app.db            # SQLite数据库文件
│   └── china.geojson     # 中国省级地理边界文件
├── app.py                # Flask + Dash 主入口
├── models.py             # SQLAlchemy ORM 模型
├── auth.py               # 注册、登录、JWT认证逻辑
├── data_loader.py        # 清洗CSV并导入数据库
├── config.py             # 配置文件（包含密钥、数据库路径等）
├── product_BBQ.csv       # 烧烤食材数据
├── product_down_jacket.csv # 羽绒服数据
├── product_Year.csv      # 年货数据
├── requirements.txt      # 依赖包列表
└── README.md             # 项目说明
```

## API接口文档

### 认证接口

#### POST /auth/register
- **功能**：用户注册
- **请求体**：
  ```json
  {
    "username": "admin",
    "email": "admin@example.com",
    "password": "password123"
  }
  ```
- **响应**：
  ```json
  {
    "msg": "User created successfully"
  }
  ```

#### POST /auth/login
- **功能**：用户登录
- **请求体**：
  ```json
  {
    "username": "admin",
    "password": "password123"
  }
  ```
- **响应**：
  ```json
  {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "username": "admin"
  }
  ```

#### GET /auth/protected
- **功能**：受保护的测试接口
- **请求头**：`Authorization: Bearer <access_token>`
- **响应**：
  ```json
  {
    "msg": "Hello admin"
  }
  ```

### 页面接口

#### GET /
- **功能**：重定向到仪表盘

#### GET /dashboard/
- **功能**：主仪表盘页面

#### GET /dashboard/products
- **功能**：商品分析页面

#### GET /dashboard/users
- **功能**：用户分析页面

#### GET /auth/login-page
- **功能**：登录页面

#### GET /auth/register-page
- **功能**：注册页面

## 数据库结构

### 商品表 (products)

| 字段名 | 类型 | 说明 |
| :--- | :--- | :--- |
| id | Integer | 主键 |
| company | String | 公司名 |
| bangdan_name | String | 榜单名 |
| ranking | Integer | 排名（0表示未上榜） |
| subject | String | 商品标题 |
| price | Float | 单价 |
| unit | String | 单位（件/袋/瓶等） |
| chengjiaov | Float | 成交金额（清洗后统一为“万元”） |
| saleVolume | Integer | 销售量（已转为整数） |
| odUrl | String | 商品链接 |
| category | String | 品类标识（BBQ/DownJacket/Year） |
| created_at | DateTime | 记录创建时间 |

### 用户表 (users)

| 字段名 | 类型 | 说明 |
| :--- | :--- | :--- |
| id | Integer | 主键 |
| username | String | 用户名（唯一） |
| password_hash | String | Bcrypt加密密码 |
| email | String | 邮箱（唯一） |
| created_at | DateTime | 注册时间 |

## 开发与运行

### 环境搭建

1. **安装依赖**：
   ```bash
   pip install -r requirements.txt
   ```

2. **配置文件**：
   - 编辑 `config.py` 文件，修改密钥等配置

3. **运行应用**：
   ```bash
   python app.py
   ```

4. **访问地址**：
   - 仪表盘：`http://localhost:5000/dashboard/`
   - 登录页面：`http://localhost:5000/auth/login-page`

### 数据导入

应用启动时会自动检查数据库是否为空，如果为空则会自动导入以下CSV文件：
- `product_BBQ.csv`（烧烤食材）
- `product_down_jacket.csv`（羽绒服）
- `product_Year.csv`（年货）

### 日志管理

- 日志文件位于 `logs/app.log`
- 支持日志轮转，单个日志文件最大10KB，保留10个备份文件

## 面试常见问题

### 技术架构

1. **Q**: 为什么选择Flask + Dash作为技术栈？
   **A**: Flask轻量灵活，适合快速开发Web服务；Dash基于Plotly，提供强大的数据可视化能力，两者结合可以快速构建BI仪表盘。

2. **Q**: 数据库为什么选择SQLite？
   **A**: SQLite轻量级，无需单独安装数据库服务，适合开发和演示环境。对于小规模数据（如本项目的商品数据）完全够用。

3. **Q**: JWT认证的优势是什么？
   **A**: JWT是无状态的，服务端不需要存储会话信息，便于水平扩展；token包含用户信息，减少数据库查询；支持过期时间设置，安全性更高。

### 数据处理

4. **Q**: 如何处理CSV中的复杂数据格式？
   **A**: 使用Pandas读取CSV文件，结合正则表达式清洗数据。例如，成交金额中的"成交0.2万+元"需要提取数字并转换为万元单位；销量中的"销40+件"需要提取数字。

5. **Q**: 数据去重的策略是什么？
   **A**: 基于商品链接（odUrl）去重，因为每个商品都有唯一的链接。在导入时会检查链接是否已存在，避免重复数据。

6. **Q**: 如何处理数据缺失的情况？
   **A**: 对缺失值进行默认处理，如价格默认为0，销量默认为0，文本字段默认为空字符串。同时在代码中添加异常捕获，确保数据导入过程不会因个别数据问题而中断。

### 可视化设计

7. **Q**: 如何选择合适的图表类型？
   **A**: 根据数据类型和分析目的选择：趋势数据用折线图，占比数据用饼图，分布数据用直方图，关系数据用散点图，地理数据用热力地图。

8. **Q**: 如何优化地图可视化？
   **A**: 使用GeoJSON格式的中国省级边界数据，确保地图显示完整；添加合适的颜色比例尺，使数据差异更明显；优化地图中心和缩放级别，确保中国地图居中显示。

9. **Q**: 如何处理大量数据的可视化？
   **A**: 对于大量数据，采用数据聚合（如按品类、按省份聚合）；限制单页显示的数据量（如商品列表限制50条）；使用分页或虚拟滚动技术。

### 性能优化

10. **Q**: 如何优化数据库查询性能？
    **A**: 使用SQLAlchemy的批量操作（bulk_save_objects）减少数据库写入次数；添加适当的索引（如商品链接字段）；使用聚合查询（sum、count、avg）减少数据传输量。

11. **Q**: 如何优化前端性能？
    **A**: 使用Dash的回调优化，避免不必要的计算；延迟加载非关键数据；优化图表渲染，减少重绘次数。

12. **Q**: 如何处理并发请求？
    **A**: Flask默认使用单线程，但可以通过WSGI服务器（如Gunicorn）实现多进程部署；使用数据库事务确保数据一致性；添加适当的缓存机制。

### 安全性

13. **Q**: 如何保护用户密码？
    **A**: 使用Flask-Bcrypt对密码进行加密存储，Bcrypt会自动添加盐值，防止彩虹表攻击。

14. **Q**: 如何防止SQL注入？
    **A**: 使用SQLAlchemy ORM，它会自动处理参数化查询，避免直接拼接SQL语句。

15. **Q**: 如何保护API接口？
    **A**: 使用JWT令牌进行身份验证；添加请求频率限制，防止暴力攻击；对敏感操作添加额外的权限检查。

### 项目管理

16. **Q**: 如何确保代码质量？
    **A**: 添加详细的代码注释；使用日志记录关键操作和错误；编写单元测试和集成测试；遵循PEP8代码规范。

17. **Q**: 如何处理版本控制？
    **A**: 使用Git进行版本控制；遵循Git Flow工作流；定期提交代码，编写清晰的提交信息。

18. **Q**: 如何部署到生产环境？
    **A**: 使用WSGI服务器（如Gunicorn）运行应用；配置反向代理（如Nginx）；添加HTTPS证书；设置环境变量存储敏感配置。

## 技能要求

### 1. 技术技能

#### 后端开发
- **Python**: 熟练掌握Python语法和标准库
- **Web框架**: 熟悉Flask或Django等Python Web框架
- **数据库**: 了解SQLite、MySQL、PostgreSQL等数据库
- **ORM**: 熟练使用SQLAlchemy等ORM工具
- **认证**: 了解JWT、OAuth等认证机制
- **数据处理**: 熟练使用Pandas进行数据处理和分析
- **正则表达式**: 能够使用正则表达式处理复杂数据格式

#### 前端开发
- **数据可视化**: 熟悉Dash、Plotly、ECharts等可视化库
- **前端框架**: 了解React、Vue等前端框架
- **CSS**: 熟悉Bootstrap等CSS框架
- **JavaScript**: 能够编写基本的JavaScript代码
- **HTML**: 了解HTML5语义化标签

#### 数据工程
- **ETL**: 了解数据提取、转换、加载的流程
- **数据清洗**: 能够处理脏数据和异常值
- **数据建模**: 了解数据仓库和数据模型设计
- **数据集成**: 能够集成不同来源的数据

### 2. 分析能力

- **业务理解**: 能够理解业务需求并转化为数据分析问题
- **数据洞察**: 能够从数据中发现有价值的信息
- **指标设计**: 能够设计合理的业务指标
- **报表设计**: 能够设计清晰有效的报表和仪表盘

### 3. 软技能

- **沟通能力**: 能够与业务人员和技术人员有效沟通
- **问题解决**: 能够独立解决技术和业务问题
- **学习能力**: 能够快速学习新的技术和工具
- **项目管理**: 能够管理和协调项目进度
- **文档编写**: 能够编写清晰的技术文档

## 总结

Acceberg BI平台是一个功能完整的商品分析系统，采用现代化的技术栈，提供直观的数据可视化和强大的分析能力。系统支持用户认证、数据导入、多维度分析等功能，适合作为BI平台开发的学习和面试参考案例。

### 项目特点

- **技术栈现代化**: 使用Flask + Dash + SQLite，适合快速开发和演示
- **功能完整**: 包含数据可视化、商品分析、用户管理等核心功能
- **代码质量高**: 包含详细的注释、日志记录和错误处理
- **扩展性强**: 模块化设计，便于后续功能扩展
- **安全性好**: 基于JWT的身份认证，密码加密存储

### 应用场景

- **商品数据分析**: 分析1688平台上的商品销售情况
- **市场趋势分析**: 了解不同品类商品的市场表现
- **公司业绩排名**: 分析不同公司的销售业绩
- **地域分布分析**: 了解不同地区的销售分布情况

### 未来扩展

- **数据源扩展**: 支持更多电商平台的数据导入
- **预测分析**: 添加销售预测和趋势分析功能
- **用户权限**: 实现更细粒度的用户权限控制
- **API扩展**: 提供更多RESTful API接口
- **实时数据**: 支持实时数据更新和监控